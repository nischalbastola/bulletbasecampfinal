{% extends "base.html" %}

{% block title %}Checkout - Bullet Basecamp{% endblock %}

{% block content %}
<section class="content-section" style="padding-top: 8rem; padding-bottom: 6rem; background: #F8F8F8;">
    <div class="container">
        <h1 class="section-title" style="text-align: center; margin-bottom: 1rem;">Secure Checkout</h1>
        <p class="section-subtitle" style="text-align: center; margin-bottom: 4rem;">Complete your booking in a few simple steps.</p>

        <form id="checkout-form" method="POST" action="{{ url_for('process_checkout') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="checkout-layout">
                <!-- Left Side: Order Summary -->
                <div class="order-summary">
                    <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; border-bottom: 2px solid #eee; padding-bottom: 0.75rem;">Your Order</h2>
                    
                    <!-- This will be populated by URL params -->
                    <input type="hidden" name="order_type" value="{{ order_details.type }}">
                    <input type="hidden" name="item_name" value="{{ order_details.name }}">
                    <input type="hidden" name="rental_days" value="{{ order_details.days }}">
                    <input type="hidden" name="number_of_bikes" value="{{ order_details.bikes }}">
                    <input type="hidden" name="pickup_datetime" value="{{ order_details.pickup_datetime }}">
                    <input type="hidden" name="addons" value="{{ order_details.addons_str }}">
                    <input type="hidden" name="final_price" value="{{ order_details.final_price_raw }}">
                    
                    <div class="summary-item">
                        <span>{{ order_details.type|capitalize }}</span>
                        <strong>{{ order_details.name }}</strong>
                    </div>

                    {% if order_details.type == 'bike' %}
                    <div class="summary-item">
                        <span>Rental Duration</span>
                        <strong>{{ order_details.days }} Day(s)</strong>
                    </div>

                    <div class="summary-item">
                        <span>Number of Bikes</span>
                        <strong>{{ order_details.bikes }} Bike(s)</strong>
                    </div>

                    <div class="summary-item">
                        <span>Pickup Date & Time</span>
                        <strong>{{ order_details.pickup_datetime_formatted }}</strong>
                    </div>

                    <div class="summary-item">
                        <span>Base Rate ({{ order_details.base_price }}/day/bike)</span>
                        <span>{{ order_details.subtotal }}</span>
                    </div>

                    {% if order_details.addons %}
                    <div style="margin: 1.5rem 0;">
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.75rem;">Selected Add-ons:</h3>
                        {% for addon in order_details.addons %}
                        <div class="summary-item">
                            <span>{{ addon.name }} (x{{ order_details.days }} days x{{ order_details.bikes }} bikes)</span>
                            <strong>{{ format_price(addon.price * order_details.days * order_details.bikes) }}</strong>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if order_details.discount > 0 %}
                    <div class="summary-item" style="color: #28a745;">
                        <span>Discount ({{ order_details.discount }}%)</span>
                        <strong>- {{ order_details.discount_amount }}</strong>
                    </div>
                    {% endif %}
                    {% elif order_details.type == 'tour' %}
                    <div class="summary-item">
                        <span>Number of Riders</span>
                        <strong>{{ order_details.days }} Rider(s)</strong>
                    </div>
                    <div class="summary-item">
                        <span>Start Date</span>
                        <strong>{{ order_details.pickup_time }}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Pickup Time</span>
                        <strong>{{ order_details.riding_type }}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Base Rate ({{ order_details.base_price }}/rider)</span>
                        <span>{{ order_details.subtotal }}</span>
                    </div>
                    {% if order_details.addons %}
                    <div style="margin: 1.5rem 0;">
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.75rem;">Selected Add-ons:</h3>
                        {% for addon in order_details.addons %}
                        <div class="summary-item">
                            <span>{{ addon.name }}</span>
                            <strong>{{ format_price(addon.price * order_details.days) }}</strong>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if order_details.discount > 0 %}
                    <div class="summary-item" style="color: #28a745;">
                        <span>Group Discount ({{ order_details.discount }}%)</span>
                        <strong>- {{ order_details.discount_amount }}</strong>
                    </div>
                    {% endif %}
                    {% endif %}

                    <div class="summary-total">
                        <span>Total Price</span>
                        <strong>{{ order_details.final_price }}</strong>
                    </div>
                </div>

                <!-- Right Side: User Details -->
                <div class="user-details">
                    <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; border-bottom: 2px solid #eee; padding-bottom: 0.75rem;">Your Details</h2>
                    <div class="form-group">
                        <label for="full-name">Full Name</label>
                        <input type="text" id="full-name" name="full_name" class="form-control" placeholder="e.g. John Doe" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" class="form-control" placeholder="e.g. you@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" name="phone" class="form-control" placeholder="For booking confirmation" required>
                    </div>

                    <div class="policy-agreement">
                        <p class="body-text" style="font-size: 0.9rem; color: #666;">
                            By clicking "Confirm Order", you agree to our <a href="{{ url_for('contact') }}#rental-policy" target="_blank">Rental Policy</a> and Terms of Service.
                        </p>
                    </div>

                    <button type="submit" class="btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem; margin-top: 1rem;">
                        Confirm Order
                    </button>
                </div>
            </div>
        </form>
    </div>
</section>

<style>
.checkout-layout {
    display: grid;
    grid-template-columns: 1.2fr 1fr;
    gap: 3rem;
}
.order-summary, .user-details {
    background: #FFFFFF;
    padding: 2.5rem;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
}
.summary-item, .summary-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    border-bottom: 1px solid #f0f0f0;
    font-size: 1rem;
}
.summary-item:last-child {
    border-bottom: none;
}
.summary-item span:first-child, .summary-total span:first-child {
    color: #666;
}
.summary-total {
    font-size: 1.3rem;
    font-weight: 700;
    padding-top: 1.5rem;
    margin-top: 1rem;
    border-top: 2px solid #000;
    border-bottom: none;
}
.form-group {
    margin-bottom: 1.5rem;
}
.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
}
.form-control {
    width: 100%;
    padding: 0.8rem 1rem;
    font-size: 1rem;
    border: 2px solid #E5E5E5;
    border-radius: 4px;
    font-family: 'Inter', sans-serif;
    transition: border-color 0.3s;
}
.form-control:focus {
    border-color: #FF6B35;
    outline: none;
}
.policy-agreement {
    margin-top: 2rem;
}

@media (max-width: 992px) {
    .checkout-layout {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %} 