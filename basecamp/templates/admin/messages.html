{% extends "base.html" %}

{% block title %}Customer Messages - Admin{% endblock %}

{% block content %}
<section class="admin-page">
    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <div class="admin-header-content">
                <a href="{{ url_for('admin_dashboard') }}" class="back-arrow-link">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5"></path>
                        <path d="M12 19l-7-7 7-7"></path>
                    </svg>
                </a>
                <div>
                    <h1 class="admin-title">Customer Messages</h1>
                    <p class="admin-subtitle">View and manage customer inquiries</p>
                </div>
            </div>
        </div>

        <!-- Messages List -->
        <div class="admin-section">
            <h2 class="section-title">All Messages ({{ messages|length }})</h2>
            {% if messages %}
                <div class="messages-table-container">
                    <table class="messages-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Service</th>
                                <th>Message Preview</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for message in messages %}
                            <tr>
                                <td class="date-cell">
                                    {{ message.created_at.strftime('%Y-%m-%d') if message.created_at else 'N/A' }}
                                </td>
                                <td class="name-cell">
                                    {{ message.name }}
                                    {% if '=== BIKE RENTAL BOOKING REQUEST ===' in message.message %}
                                        <span class="booking-indicator">
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 0.25rem;">
                                                <path d="M19,7H22V9H21V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V9H2V7H5A2,2 0 0,1 7,5H17A2,2 0 0,1 19,7M7,9V19H19V9H7M9,11H17V13H9V11M9,15H17V17H9V15Z"/>
                                            </svg>
                                            BOOKING
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="email-cell">{{ message.email }}</td>
                                <td class="service-cell">
                                    <span class="service-badge">{{ message.service or 'General' }}</span>
                                </td>
                                <td class="message-cell">
                                    {% if '=== BIKE RENTAL BOOKING REQUEST ===' in message.message %}
                                        <strong>Bike Rental Request</strong> - Contains booking details and add-ons
                                    {% else %}
                                        {{ message.message[:80] }}{% if message.message|length > 80 %}...{% endif %}
                                    {% endif %}
                                </td>
                                <td class="actions-cell">
                                    <a href="{{ url_for('admin_message_detail', message_id=message.id) }}" class="view-btn">View</a>
                                    <form method="POST" action="{{ url_for('admin_delete_message_route', message_id=message.id) }}" class="delete-form" data-item-type="Message" data-item-name="from {{ message.name }}">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                        <button type="submit" class="delete-btn">Delete</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty-state">
                    <p>No customer messages yet. Messages will appear here when customers contact you through the website.</p>
                </div>
            {% endif %}
        </div>
    </div>
</section>

<style>
.admin-page {
    background: #F8F8F8;
    min-height: 100vh;
    padding: 2rem 0;
}

.admin-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
}

.admin-header {
    background: #FFFFFF;
    border-radius: 0;
    padding: 2rem;
    margin-bottom: 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.admin-header-content {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.back-arrow-link {
    color: #ff6b35;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    border-radius: 50%;
    transition: background-color 0.3s ease;
}

.back-arrow-link:hover {
    background-color: rgba(255, 107, 53, 0.1);
}

.admin-title {
    font-size: 2rem;
    font-weight: 900;
    color: #000000;
    text-transform: uppercase;
    letter-spacing: -0.01em;
    margin: 0 0 0.5rem;
}

.admin-subtitle {
    color: #666666;
    font-size: 1rem;
    margin: 0;
}

.admin-section {
    background: #FFFFFF;
    border-radius: 0;
    padding: 2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.section-title {
    font-size: 1.5rem;
    font-weight: 800;
    color: #000000;
    text-transform: uppercase;
    letter-spacing: -0.01em;
    margin: 0 0 2rem;
}

.messages-table-container {
    overflow-x: auto;
}

.messages-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 800px;
}

.messages-table th {
    background: #F8F8F8;
    color: #000000;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 0.9rem;
    letter-spacing: 0.05em;
    padding: 1rem;
    text-align: left;
    border-bottom: 2px solid #E5E5E5;
}

.messages-table td {
    padding: 1rem;
    border-bottom: 1px solid #E5E5E5;
    vertical-align: top;
}

.messages-table tr:hover {
    background: #FEFEFE;
}

.date-cell {
    font-family: monospace;
    color: #666666;
    white-space: nowrap;
}

.name-cell {
    font-weight: 600;
    color: #000000;
}

.email-cell {
    color: #666666;
    font-size: 0.9rem;
}

.service-cell .service-badge {
    background: #FF6B35;
    color: #FFFFFF;
    padding: 0.25rem 0.75rem;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    white-space: nowrap;
}

.booking-indicator {
    display: inline-flex;
    align-items: center;
    background: #4CAF50;
    color: #FFFFFF;
    padding: 0.2rem 0.5rem;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    border-radius: 3px;
    margin-left: 0.5rem;
}

.message-cell {
    color: #666666;
    line-height: 1.4;
    max-width: 300px;
}

.actions-cell {
    white-space: nowrap;
}

.view-btn {
    background: #FF6B35;
    color: #FFFFFF;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    font-weight: 600;
    text-transform: uppercase;
    text-decoration: none;
    border-radius: 0;
    transition: all 0.3s ease;
    display: inline-block;
    margin-right: 0.5rem;
}

.view-btn:hover {
    background: #E55A2B;
}

.delete-form {
    display: inline-block;
    margin: 0;
}

.delete-btn {
    background: #DC2626;
    color: #FFFFFF;
    border: none;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    font-weight: 600;
    text-transform: uppercase;
    border-radius: 0;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: 'Inter', sans-serif;
}

.delete-btn:hover {
    background: #991B1B;
}

.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: #666666;
}

.flash-messages {
    margin-bottom: 2rem;
}

.flash-message {
    padding: 1rem 1.5rem;
    margin-bottom: 1rem;
    border-radius: 0;
    font-weight: 500;
}

.flash-error {
    background: #FEE;
    color: #DC2626;
    border-left: 4px solid #DC2626;
}

.flash-success {
    background: #F0FDF4;
    color: #16A34A;
    border-left: 4px solid #16A34A;
}

@media (max-width: 768px) {
    .admin-container {
        padding: 0 1rem;
    }
    
    .admin-header,
    .admin-section {
        padding: 1.5rem;
    }
    
    .messages-table th,
    .messages-table td {
        padding: 0.75rem 0.5rem;
    }
    
    .message-cell {
        max-width: 200px;
    }
    
    .actions-cell {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .view-btn {
        margin-right: 0;
    }
}
</style>
{% endblock %} 